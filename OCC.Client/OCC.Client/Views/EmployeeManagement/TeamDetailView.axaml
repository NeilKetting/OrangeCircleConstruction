<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:OCC.Client.ViewModels.EmployeeManagement"
             mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="600"
             x:Class="OCC.Client.Views.EmployeeManagement.TeamDetailView"
             x:DataType="vm:TeamDetailViewModel">

    <Border Background="White" CornerRadius="8" Padding="0" BoxShadow="0 4 10 0 #40000000" Width="600" MaxHeight="700">
        <Grid RowDefinitions="Auto, *, Auto">
            
            <!-- Header -->
            <Border Grid.Row="0" BorderBrush="{DynamicResource BorderGray}" BorderThickness="0,0,0,1" Padding="20">
                <StackPanel Orientation="Horizontal" Spacing="10">
                     <PathIcon Data="{StaticResource IconTeam}" Width="20" Height="20" Foreground="{DynamicResource PrimaryBlue}"/>
                     <TextBlock Text="{Binding Title}" FontSize="18" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryDark}"/>
                </StackPanel>
            </Border>

            <!-- Content -->
            <ScrollViewer Grid.Row="1" Padding="20">
                <StackPanel Spacing="15">
                     <!-- Team Name -->
                     <StackPanel Spacing="5">
                         <TextBlock Text="Team Name" FontWeight="Medium" Foreground="{DynamicResource TextSecondaryGray}"/>
                         <TextBox Text="{Binding Name}" Watermark="Enter team name" Classes="StandardTextBox"/>
                     </StackPanel>

                     <!-- Description -->
                     <StackPanel Spacing="5">
                         <TextBlock Text="Description" FontWeight="Medium" Foreground="{DynamicResource TextSecondaryGray}"/>
                         <TextBox Text="{Binding Description}" Watermark="Enter description" Classes="StandardTextBox"/>
                     </StackPanel>

                     <!-- Members Section (Only meaningful if team exists) -->
                     <StackPanel Spacing="10" Margin="0,15,0,0">
                         <TextBlock Text="Team Members" FontSize="16" FontWeight="SemiBold"/>
                         
                         <!-- Add Member Controls -->
                         <Grid ColumnDefinitions="*, Auto">
                             <ComboBox PlaceholderText="Select employee to add..." 
                                       ItemsSource="{Binding AvailableEmployees}"
                                       SelectedItem="{Binding SelectedEmployeeToAdd}"
                                       HorizontalAlignment="Stretch" Margin="0,0,10,0">
                                 <ComboBox.ItemTemplate>
                                     <DataTemplate>
                                         <TextBlock Text="{Binding FirstName, StringFormat='{}{0}'}"/> 
                                         <!-- Need full name logic, binding checks -->
                                     </DataTemplate>
                                 </ComboBox.ItemTemplate>
                             </ComboBox>
                             
                             <Button Grid.Column="1" Command="{Binding AddMemberCommand}" Classes="Primary" IsEnabled="{Binding SelectedEmployeeToAdd, Converter={x:Static ObjectConverters.IsNotNull}}">
                                 <TextBlock Text="Add"/>
                             </Button>
                         </Grid>

                         <!-- Member List -->
                         <DataGrid ItemsSource="{Binding Members}" Height="200" AutoGenerateColumns="False" IsReadOnly="True" BorderThickness="1" BorderBrush="#E0E0E0">
                             <DataGrid.Columns>
                                 <DataGridTextColumn Header="NAME" Binding="{Binding Name}" Width="*"/>
                                 <DataGridTextColumn Header="ROLE" Binding="{Binding Role}" Width="Auto"/>
                                 <DataGridTemplateColumn Width="Auto">
                                     <DataGridTemplateColumn.CellTemplate>
                                         <DataTemplate>
                                             <Button Classes="IconButton" Command="{Binding $parent[UserControl].((vm:TeamDetailViewModel)DataContext).RemoveMemberCommand}" CommandParameter="{Binding .}" Foreground="Red" ToolTip.Tip="Remove Member">
                                                 <PathIcon Data="{StaticResource IconDelete}" Width="14" Height="14"/>
                                             </Button>
                                         </DataTemplate>
                                     </DataGridTemplateColumn.CellTemplate>
                                 </DataGridTemplateColumn>
                             </DataGrid.Columns>
                         </DataGrid>
                     </StackPanel>
                </StackPanel>
            </ScrollViewer>

            <!-- Footer Buttons -->
            <Border Grid.Row="2" Background="{DynamicResource SurfaceLightGray}" BorderBrush="{DynamicResource BorderGray}" BorderThickness="0,1,0,0" CornerRadius="0,0,8,8" Padding="20">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="10">
                    <Button Command="{Binding CancelCommand}" Content="Cancel" Classes="Secondary" Width="100"/>
                    <Button Command="{Binding SaveCommand}" Content="Save" Classes="Primary" Width="100"/>
                </StackPanel>
            </Border>
        </Grid>
    </Border>
</UserControl>
