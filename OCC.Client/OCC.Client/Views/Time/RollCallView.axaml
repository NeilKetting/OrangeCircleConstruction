<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:OCC.Client.ViewModels.Time"
             xmlns:models="clr-namespace:OCC.Shared.Models;assembly=OCC.Shared"
             xmlns:conv="clr-namespace:OCC.Client.Converters"
             mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="800"
             x:Class="OCC.Client.Views.Time.RollCallView"
             x:Name="Root"
             x:DataType="vm:RollCallViewModel">

	<Border Background="White" CornerRadius="12" BoxShadow="0 4 20 0 #20000000" Margin="20" MinWidth="850">
		<Grid RowDefinitions="Auto, *, Auto" Margin="25">
			<!-- Header -->
			<Grid Grid.Row="0" ColumnDefinitions="Auto, *, Auto, Auto" Margin="0,0,0,20">
				<StackPanel Grid.Column="0">
					<TextBlock Text="Daily Roll-Call" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryDark}"/>
					<TextBlock Text="{Binding Date, StringFormat='{}{0:dddd, dd MMMM yyyy}'}" Foreground="{DynamicResource TextSecondaryGray}" FontSize="12"/>
				</StackPanel>
                
				<!-- Branch Selector -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="20" Margin="0,0,20,0">
                    <ComboBox ItemsSource="{Binding Branches}" SelectedItem="{Binding SelectedBranch}" 
                              Width="150" VerticalAlignment="Center" Classes="FormInput"/>
                </StackPanel>

				<Button Grid.Column="3" Command="{Binding CancelCommand}" Classes="Close">
					<PathIcon Data="{StaticResource IconClose}" Width="14" Height="14"/>
				</Button>
			</Grid>

			<!-- Staff List -->
			<ScrollViewer Grid.Row="1">
				<ItemsControl ItemsSource="{Binding StaffList}">
					<ItemsControl.ItemTemplate>
						<DataTemplate>
							<Border BorderBrush="{DynamicResource BorderGray}" BorderThickness="0,0,0,1" Padding="10,15">
								<Grid RowDefinitions="Auto, Auto">
									<Grid ColumnDefinitions="2*, Auto, Auto, Auto, 3*">
                                        <!-- Name & Role -->
										<StackPanel Grid.Column="0" VerticalAlignment="Center">
											<TextBlock Text="{Binding Name}" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryDark}"/>
											<TextBlock Text="{Binding Role}" FontSize="11" Foreground="{DynamicResource TextSecondaryGray}"/>
										</StackPanel>

                                        <!-- Override Checkbox -->
                                        <CheckBox Grid.Column="1" IsChecked="{Binding IsOverrideEnabled}" Content="Override" VerticalAlignment="Center" Margin="0,0,15,0"/>

                                        <!-- Clock Actions -->
                                        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="10" Margin="0,0,15,0">
                                            <Button Classes="Primary" Width="80" Height="34" Padding="0"
                                                    HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                                                    Command="{Binding #Root.((vm:RollCallViewModel)DataContext).ClockIndividualCommand}"
                                                    CommandParameter="{Binding}" ToolTip.Tip="Clock In">
                                                <TextBlock Text="In" FontSize="12" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                            </Button>
                                            
                                            <Button Width="80" Height="34" Padding="0"
                                                    Background="#D32F2F" Foreground="White" BorderThickness="0" CornerRadius="4"
                                                    HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                                                    Command="{Binding #Root.((vm:RollCallViewModel)DataContext).ClockOutIndividualCommand}"
                                                    CommandParameter="{Binding}" ToolTip.Tip="Clock Out">
                                                <TextBlock Text="Out" FontSize="12" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                            </Button>
                                        </StackPanel>
                                        
                                        <!-- Time Override Pickers (Visible only if Item Override Checked) -->
                                        <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="5" Margin="0,0,15,0"
                                                    IsVisible="{Binding IsOverrideEnabled}">
                                            <StackPanel>
                                                 <TextBlock Text="In Time" FontSize="9" Foreground="Gray" HorizontalAlignment="Center"/>
                                                 <TimePicker SelectedTime="{Binding ClockInTime}" ClockIdentifier="24HourClock" MinuteIncrement="5"/>
                                            </StackPanel>
                                            <StackPanel>
                                                 <TextBlock Text="Out Time" FontSize="9" Foreground="Gray" HorizontalAlignment="Center"/>
                                                 <TimePicker SelectedTime="{Binding ClockOutTime}" ClockIdentifier="24HourClock" MinuteIncrement="5"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Status Radios -->
										<StackPanel Grid.Column="4" Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
											<RadioButton Content="Present" IsChecked="{Binding Status, Converter={x:Static conv:EnumToBooleanConverter.Instance}, ConverterParameter={x:Static models:AttendanceStatus.Present}}"/>
											<RadioButton Content="Absent" IsChecked="{Binding Status, Converter={x:Static conv:EnumToBooleanConverter.Instance}, ConverterParameter={x:Static models:AttendanceStatus.Absent}}"/>
											<RadioButton Content="Sick" IsChecked="{Binding Status, Converter={x:Static conv:EnumToBooleanConverter.Instance}, ConverterParameter={x:Static models:AttendanceStatus.Sick}}"/>
										</StackPanel>
									</Grid>

									<!-- Extra fields for non-present status -->
									<StackPanel Grid.Row="1" Margin="0,10,0,0" Spacing="10" IsVisible="{Binding Status, Converter={x:Static conv:EnumToBooleanConverter.NotPresent}}">
										<TextBox Watermark="Reason/Comments..." Text="{Binding LeaveReason}" Classes="FormInput"/>
										<Button Content="Attach Doctor's Note" Classes="ToolbarAction" IsVisible="{Binding Status, Converter={x:Static conv:EnumToBooleanConverter.Instance}, ConverterParameter={x:Static models:AttendanceStatus.Sick}}"/>
									</StackPanel>
								</Grid>
							</Border>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>
			</ScrollViewer>

			<!-- Footer -->
			<StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="10" Margin="0,20,0,0">
				<Button Content="Cancel" Command="{Binding CancelCommand}" Classes="ToolbarAction"/>
				<Button Content="Complete Roll-Call" Command="{Binding SaveCommand}" Background="{DynamicResource PrimaryTeal}" Foreground="White" Padding="20,10" CornerRadius="6" FontWeight="Bold"/>
			</StackPanel>
		</Grid>
	</Border>
</UserControl>
