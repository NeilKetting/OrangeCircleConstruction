
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:OCC.Client.ViewModels.Settings"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="OCC.Client.Views.Settings.CompanySettingsView"
             x:DataType="vm:CompanySettingsViewModel">

    <Border Background="{DynamicResource SurfaceWhite}"
            CornerRadius="0"
            BoxShadow="0 2 15 5 #292828"
            Margin="20"
            VerticalAlignment="Stretch"
            HorizontalAlignment="Stretch">
        <Grid RowDefinitions="Auto, *, Auto, Auto">

            <!-- Header -->
            <Border Grid.Row="0"
                    Background="White"
                    BorderThickness="0,0,0,2"
                    BorderBrush="{DynamicResource PrimaryTeal}"
                    Padding="20,15">
                <Grid ColumnDefinitions="*, Auto">
                    <StackPanel Spacing="5">
                        <TextBlock Text="Company Profile" FontSize="24" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryDark}"/>
                        <TextBlock Text="Manage company details and settings." FontSize="16" Foreground="{DynamicResource TextSecondaryGray}"/>
                    </StackPanel>
                    <Button Grid.Column="1" Command="{Binding CloseCommand}" Classes="IconButton" VerticalAlignment="Top" ToolTip.Tip="Close">
                        <PathIcon Data="{StaticResource IconClose}" Width="16" Height="16"/>
                    </Button>
                </Grid>
            </Border>

            <!-- Scrollable Content -->
            <ScrollViewer Grid.Row="1" Padding="40,30">
                <Grid ColumnDefinitions="*, 50, *, 50, *">
                    
                    <!-- Left Column: General Info -->
                    <StackPanel Grid.Column="0" Spacing="20">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <PathIcon Data="{StaticResource IconSettings}" Width="20" Height="20" Foreground="{DynamicResource PrimaryTeal}"/>
                            <TextBlock Text="General Information" FontSize="18" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryDark}"/>
                        </StackPanel>

                        <StackPanel Spacing="10">
                            <StackPanel>
                                <TextBlock Text="Company Name" Classes="FormLabel"/>
                                <TextBox Text="{Binding CompanyDetails.CompanyName}" Classes="FormInput" Watermark="e.g. Orange Circle Construction"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="Registration Number" Classes="FormLabel"/>
                                <TextBox Text="{Binding CompanyDetails.RegistrationNumber}" Classes="FormInput" Watermark="e.g. 2020/123456/07"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="VAT Number" Classes="FormLabel"/>
                                <TextBox Text="{Binding CompanyDetails.VatNumber}" Classes="FormInput" Watermark="e.g. 4123456789"/>
                            </StackPanel>

                             <StackPanel>
                                <TextBlock Text="Phone Number" Classes="FormLabel"/>
                                <TextBox Text="{Binding CompanyDetails.Phone}" Classes="FormInput" Watermark="e.g. +27 11 123 4567"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="Email Address" Classes="FormLabel"/>
                                <TextBox Text="{Binding CompanyDetails.Email}" Classes="FormInput" Watermark="e.g. info@orangecircle.co.za"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="Website" Classes="FormLabel"/>
                                <TextBox Text="{Binding CompanyDetails.Website}" Classes="FormInput" Watermark="e.g. www.orangecircle.co.za"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>

                    <!-- Middle Column: Address & Banking -->
                    <StackPanel Grid.Column="2" Spacing="20">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <PathIcon Data="{StaticResource IconHome}" Width="20" Height="20" Foreground="{DynamicResource PrimaryTeal}"/> <!-- Assuming IconHome exists or similar -->
                            <TextBlock Text="Location &amp; Banking" FontSize="18" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryDark}"/>
                        </StackPanel>

                        <StackPanel Spacing="10">
                            <StackPanel>
                                <TextBlock Text="Address Line 1" Classes="FormLabel"/>
                                <TextBox Text="{Binding CompanyDetails.AddressLine1}" Classes="FormInput" Watermark="Street Address"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="Address Line 2" Classes="FormLabel"/>
                                <TextBox Text="{Binding CompanyDetails.AddressLine2}" Classes="FormInput" Watermark="Suburb / Building"/>
                            </StackPanel>

                            <Grid ColumnDefinitions="*, 10, *">
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="City" Classes="FormLabel"/>
                                    <TextBox Text="{Binding CompanyDetails.City}" Classes="FormInput" Watermark="City"/>
                                </StackPanel>
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Postal Code" Classes="FormLabel"/>
                                    <TextBox Text="{Binding CompanyDetails.PostalCode}" Classes="FormInput" Watermark="Code"/>
                                </StackPanel>
                            </Grid>

                             <Separator Background="{DynamicResource SurfaceBorder}" Margin="0,10"/>
                             
                             <StackPanel>
                                <TextBlock Text="Bank Name" Classes="FormLabel"/>
                                <TextBox Text="{Binding CompanyDetails.BankName}" Classes="FormInput" Watermark="e.g. FNB"/>
                            </StackPanel>

                             <StackPanel>
                                <TextBlock Text="Account Name" Classes="FormLabel"/>
                                <TextBox Text="{Binding CompanyDetails.AccountName}" Classes="FormInput" Watermark="Account Holder Name"/>
                            </StackPanel>

                             <Grid ColumnDefinitions="*, 10, *">
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Account Number" Classes="FormLabel"/>
                                    <TextBox Text="{Binding CompanyDetails.AccountNumber}" Classes="FormInput" Watermark="Account Number"/>
                                </StackPanel>
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Branch Code" Classes="FormLabel"/>
                                    <TextBox Text="{Binding CompanyDetails.BranchCode}" Classes="FormInput" Watermark="Branch Code"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </StackPanel>

                    <!-- Right Column: Departments -->
                    <StackPanel Grid.Column="4" Spacing="20">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <PathIcon Data="{StaticResource IconEmail}" Width="20" Height="20" Foreground="{DynamicResource PrimaryTeal}"/> <!-- IconBell or similar -->
                            <TextBlock Text="Department Emails" FontSize="18" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryDark}"/>
                        </StackPanel>

                        <StackPanel Spacing="10">
                            <TextBlock Text="Manage recipient emails for system notifications." FontSize="12" Foreground="{DynamicResource TextSecondaryGray}" TextWrapping="Wrap"/>
                            
                            <ScrollViewer MaxHeight="400">
                                <ItemsControl ItemsSource="{Binding Departments}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="White" BorderBrush="{DynamicResource ThemeBorderLow}" BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,0,0,10">
                                                <Grid ColumnDefinitions="*, 10, Auto">
                                                    <StackPanel Grid.Column="0" Spacing="5">
                                                        <TextBox Text="{Binding Department}" Classes="FormInput" Watermark="Department Name" FontSize="12"/>
                                                        <TextBox Text="{Binding EmailAddress}" Classes="FormInput" Watermark="Email Address" FontSize="12"/>
                                                    </StackPanel>
                                                    <Button Grid.Column="2" Classes="IconOnly" VerticalAlignment="Center" 
                                                            Command="{Binding $parent[UserControl].((vm:CompanySettingsViewModel)DataContext).RemoveDepartmentCommand}" 
                                                            CommandParameter="{Binding}"
                                                            ToolTip.Tip="Remove Department">
                                                        <PathIcon Data="{StaticResource IconDelete}" Height="16" Width="16" Foreground="Red"/>
                                                    </Button>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>

                            <Button Content="Add New Department" Command="{Binding AddDepartmentCommand}" Classes="Secondary" HorizontalAlignment="Stretch"/>
                        </StackPanel>
                    </StackPanel>

                </Grid>
            </ScrollViewer>

            <!-- Footer Separator -->
            <Grid Grid.Row="2" Height="2" Background="{DynamicResource PrimaryTeal}"/>

            <!-- Action Buttons -->
            <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="10" Margin="20,15" HorizontalAlignment="Left">
                <Button Content="Close" Command="{Binding CloseCommand}" Classes="Secondary" ToolTip.Tip="Close Settings"/>
                <Button Content="Save Changes" Command="{Binding SaveCommand}" Classes="Primary" ToolTip.Tip="Save company details"/>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
