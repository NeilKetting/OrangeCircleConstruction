<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:OCC.Client.ViewModels.Projects"
             xmlns:local="clr-namespace:OCC.Client.Views.Projects"
             mc:Ignorable="d"
             x:Class="OCC.Client.Views.Projects.CreateProjectView"
             x:DataType="vm:CreateProjectViewModel">

    <UserControl.Styles>
        <Style Selector="RadioButton">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryGray}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Padding" Value="8,0,0,0"/>
            <Setter Property="Margin" Value="0,4"/>
        </Style>
    </UserControl.Styles>
    
    <Grid>
        <!-- Modal Overlay Background (handled by parent, but we add a shadow wrapper here) -->
        <Border Background="White" CornerRadius="8" BoxShadow="0 8 30 0 #50000000" Width="{Binding ModalWidth}" Height="600" VerticalAlignment="Center" HorizontalAlignment="Center">
            <Border.Transitions>
                <Transitions>
                    <DoubleTransition Property="Width" Duration="0:0:0.3" Easing="CubicEaseOut"/>
                </Transitions>
            </Border.Transitions>
            
            <Grid>
                <Grid ColumnDefinitions="*, Auto" Margin="40">
                    
                    <!-- LEFT COLUMN: Main Creation Form -->
                    <Grid Grid.Column="0" RowDefinitions="Auto, *, Auto" Margin="0,0,20,0">
                        
                        <!-- Header -->
                        <Grid ColumnDefinitions="*, Auto" Grid.Row="0" Margin="0,0,0,30">
                            <TextBlock Text="Create New Project" FontSize="26" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryDark}"/>
                            <Button Grid.Column="1" Command="{Binding CloseCommand}" Classes="Close">
                                <PathIcon Data="{StaticResource IconClose}" Width="16" Height="16"/>
                            </Button>
                        </Grid>

                        <!-- Form -->
                        <Grid Grid.Row="1" VerticalAlignment="Top">
                            <StackPanel Spacing="25">
                                <!-- Project Name Input -->
                                <Grid ColumnDefinitions="*, Auto">
                                    <TextBox Text="{Binding ProjectName}" Watermark="New Project Name" Classes="ModernTextBox" Height="45" VerticalContentAlignment="Center" FontSize="15"/>
                                    <Button Grid.Column="1" Command="{Binding ToggleSettingsCommand}" Classes="IconButton" Margin="10,0,0,0">
                                        <PathIcon Data="{StaticResource IconSettings}" Width="20" Height="20" Foreground="{DynamicResource TextSecondaryGray}"/>
                                    </Button>
                                </Grid>

                                <!-- Share Options -->
                                <StackPanel>
                                    <TextBlock Text="SHARE WITH" FontSize="11" FontWeight="Bold" Foreground="{DynamicResource TextTertiarySlate}" Margin="0,0,0,10"/>
                                    
                                    <RadioButton GroupName="Share" IsChecked="{Binding IsJustMe}" Content="Just Me"/>
                                    <RadioButton GroupName="Share" IsChecked="{Binding IsEveryone}" Content="Everyone"/>
                                    <RadioButton GroupName="Share" IsChecked="{Binding IsSpecific}" Content="Specific People"/>
                                </StackPanel>

                                <!-- Secondary Actions -->
                                <StackPanel Orientation="Vertical" Spacing="15" Margin="0,10,0,0">
                                    <Button Content="Import File" Click="ImportFile_Click"
                                            Background="#E2E8F0" Foreground="{DynamicResource TextPrimaryDark}" 
                                            Padding="15,10" CornerRadius="4" FontSize="13" FontWeight="SemiBold"/>
                             <Button Content="Create Project" Command="{Binding CreateProjectCommand}" 
                                     Background="{DynamicResource PrimaryTeal}" Foreground="White"
                                     Padding="25,12" CornerRadius="4" 
                                     HorizontalAlignment="Left" FontSize="14" FontWeight="SemiBold"/>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </Grid>

                    <!-- RIGHT COLUMN: Settings Panel -->
                    <Border Grid.Column="1" 
                            IsVisible="{Binding IsSettingsVisible}" 
                            BorderBrush="{DynamicResource BorderGray}" 
                            BorderThickness="1,0,0,0" 
                            Padding="30,0,0,0" 
                            Width="400">
                        <local:CreateProjectDetailsView />
                    </Border>
                    
                </Grid>

                <!-- IMPORT PROGRESS OVERLAY -->
                <Grid IsVisible="{Binding IsImporting}" Background="#CCFFFFFF" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="15">
                        <ProgressBar IsIndeterminate="True" Width="200" Height="4"/>
                        <TextBlock Text="{Binding ImportProgressMessage}" Foreground="{DynamicResource TextPrimaryDark}" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>

                <!-- IMPORT COMPLETE OVERLAY -->
                <Grid IsVisible="{Binding ShowImportComplete}" Background="#CCFFFFFF" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                    <Border Background="White" CornerRadius="8" BoxShadow="0 4 20 0 #40000000" Padding="30" VerticalAlignment="Center" HorizontalAlignment="Center" Width="350">
                        <StackPanel Spacing="20">
                            <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">
                                <PathIcon Data="{StaticResource IconCheckCircle}" Width="24" Height="24" Foreground="{DynamicResource StatusGreen}"/>
                                <TextBlock Text="Import Completed" FontSize="18" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryDark}" VerticalAlignment="Center"/>
                            </StackPanel>
                            
                            <TextBlock Text="The project file has been parsed successfully. Would you like to create the project now?" 
                                       TextWrapping="Wrap" TextAlignment="Center" Foreground="{DynamicResource TextSecondaryGray}"/>

                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="15">
                                 <Button Content="No, Review" Command="{Binding CancelImportSaveCommand}" Background="Transparent" Foreground="{DynamicResource TextSecondaryGray}"/>
                                 <Button Content="Yes, Create Project" Command="{Binding ConfirmImportSaveCommand}" Background="{DynamicResource PrimaryTeal}" Foreground="White" FontWeight="Bold"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Grid>
            </Grid>

        </Border>
    </Grid>
</UserControl>
